<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DOOM.fun</title>
  <style>
    html,body{margin:0;height:100%;background:#0b0b0b;color:#e7e7e7;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    header{padding:14px 18px;border-bottom:1px solid #222;display:flex;gap:10px;align-items:center}
    h1{font-size:18px;margin:0} #status{font-size:12px;color:#9aa0a6}
    main{padding:16px}
    canvas{display:block;margin:0 auto;width:min(96vw,1024px);aspect-ratio:4/3;background:#000;border-radius:10px;box-shadow:0 8px 28px rgba(0,0,0,.55);outline:none}
    .controls{display:flex;gap:10px;justify-content:center;flex-wrap:wrap;margin-top:12px}
    button{padding:10px 14px;border-radius:999px;border:1px solid #333;background:#161616;color:#e7e7e7;font-weight:600;cursor:pointer}
    button:hover{background:#1f1f1f}
    a.small{color:#9aa0a6;font-size:12px;text-decoration:none}
    pre{white-space:pre-wrap;background:#111;padding:10px;border-radius:8px;color:#9aa0a6;max-width:960px;margin:12px auto}
  </style>
</head>
<body>
  <header>
    <h1>DOOM.fun</h1>
    <span id="status" aria-live="polite">Ready</span>
  </header>

  <main>
    <canvas id="canvas" tabindex="0"></canvas>
    <div class="controls">
      <button id="startBtn">Start</button>
      <button id="fullscreenBtn">Fullscreen</button>
      <a class="small">Click canvas → <kbd>WASD</kbd> + mouse. <kbd>Esc</kbd> unlocks pointer.</a>
    </div>
    <pre id="log" hidden></pre>
  </main>

  <script>
    // === your hosted asset URLs on GitHub Pages ===
    const BASE   = "https://jconstantine627752-maker.github.io/doom.fun/";
    const JS_URL = BASE + "chocolate-doom.js";
    const WASM_URL = BASE + "chocolate-doom.wasm";
    const WAD_URL  = BASE + "doom1.wad";

    const statusEl = document.getElementById("status");
    const logEl = document.getElementById("log");
    const canvas = document.getElementById("canvas");
    const setStatus = (m)=>statusEl.textContent = m;
    const log = (m)=>{ console.log(m); logEl.hidden=false; logEl.textContent += m + "\n"; };

    async function start() {
      try {
        setStatus("Loading engine…");
        // Load the Emscripten glue JS from GitHub Pages
        await new Promise((resolve, reject) => {
          const s = document.createElement("script");
          s.src = JS_URL; s.async = true;
          s.onload = resolve;
          s.onerror = () => reject(new Error("Failed to load chocolate-doom.js"));
          document.head.appendChild(s);
        });

        // Configure Emscripten Module to fetch assets via URLs (no base64)
        window.Module = {
          print: (t)=>log(t),
          printErr: (t)=>log("[err] " + t),
          canvas,
          setStatus,
          preRun: [ () => {
            // Let Emscripten fetch doom1.wad by URL and mount it at /doom1.wad
            FS.createPreloadedFile("/", "doom1.wad", WAD_URL, true, true);
          }],
          arguments: ["-iwad","doom1.wad"],
          // When the glue looks for the .wasm file, point it to your hosted URL
          locateFile: (path) => path.endsWith(".wasm") ? WASM_URL : path
        };

        setStatus("Starting DOOM…");
        if (typeof createModule !== "function") throw new Error("createModule() not found");
        await createModule(Module);
        setTimeout(()=>canvas.focus(), 0);
        setStatus("Running");
      } catch (err) {
        console.error(err);
        setStatus("Error: " + (err && err.message ? err.message : err));
        log(String(err.stack || err));
      }
    }

    document.getElementById("startBtn").onclick = start;
    document.getElementById("fullscreenBtn").onclick = () => canvas.requestFullscreen?.();
  </script>
</body>
</html>
